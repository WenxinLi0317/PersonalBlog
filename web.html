<script src="script.js"></script>

<title>My Personal Blog</title>
<div style="text-align: center;">

  <img src="image/journal.jpg" style="width:400px; height:auto;">

  <h1 style="font-size: 50;">
      MY PERSONAL BLOG
  </h1>

<h3 style="font-size: 22;">
    Sep 15th, 2025 <br>
    <br>today my dog died.<br>
    <br>ðŸ’”<br>
</h3>

<form id="form">
  <label >Title:</label><br>
  <input type="text" id="title"><br>
  <label >Blog Text:</label><br>
  <input type="text" id="text" ><br><br>
  <input type="submit" value="Done">
</form>

<div id="output"></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
  const dbUrl = 'https://xyztqwtnhkcoxdixrnty.supabase.co';
  const dbKey = 'sb_publishable_5LUxqf9TEsGpNxAFJirgcA_-7FQleNf'
  const db = supabase.createClient(dbUrl, dbKey);

  index = 0
  arr=[]

  fetchDataAndPopulateArray();

  async function fetchDataAndPopulateArray() {
    try {
      const { data, error } = await db
        .from('posts')
        .select('title, text')
        .order('created_at', { ascending: false });

      if (error) {
        console.error('Error fetching data:', error);
        return;
      }

      arr.length = 0;

      data.forEach(item => {
        arr.push({
          title: item.title,
          text: item.text
        });
      });
      
      updateOutput();
      
    } catch (err) {
      console.error('fetch operation error: ', err);
    }
  }

  function updateOutput() {
    let result = "";
    for (let i = 0; i < arr.length; i++){
      result += `${arr[i].title} ${arr[i].text}!<br>`;
    }
    output.innerHTML = result;
  }

  const form = document.getElementById("form");
  const output = document.getElementById("output");

  form.addEventListener("submit", async function(event){
    event.preventDefault();

    const title = document.getElementById("title").value;
    const text = document.getElementById("text").value;

    const {data, error} = await db
      .from('posts')
      .insert([{title: title, text: text}])
    if(error) {
      output.innerHTML = "Error: " + error.message;
    } else {
      arr.push({title, text})
      updateOutput();
    }
  });
</script>

</div>