

<title>My Personal Blog</title>
<div style="text-align: center; background-image: url('image/bg.jpg');  background-position: center;">

  <img src="image/journal.png" style="width:400px; height:auto;">

   <h1 style="font-size: 48px; margin-bottom: 20px;">

      MY PERSONAL BLOG
  </h1>

 <h3>Enter Your Blog Entry Here</h3>


<form id="form">
  <input type="text" id="title" placeholder="Enter Blog Title" style="width: 300px; padding: 10px; border-radius: 8px; border: none;">
  <input type="text" id="text" placeholder="Enter Blog Text" style="width: 300px; padding: 10px; border-radius: 8px; border: none;" >
 <br><br>
 <input type="submit" value="Done" style="width: 300px; padding: 10px; border-radius: 8px; border: none; background: #ff5c5c; color:white">
 <br><br>
</form>


<div id="output"></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
  const dbUrl = 'https://xyztqwtnhkcoxdixrnty.supabase.co';
  const dbKey = 'sb_publishable_5LUxqf9TEsGpNxAFJirgcA_-7FQleNf'
  const db = supabase.createClient(dbUrl, dbKey);

  index = 0
  arr=[]

  fetchDataAndPopulateArray();

  async function fetchDataAndPopulateArray() {
    try {
      const { data, error } = await db
        .from('posts')
        .select('title, text')
        .order('created_at', { ascending: false });

      if (error) {
        console.error('Error fetching data:', error);
        return;
      }

      arr.length = 0;

      data.forEach(item => {
        arr.push({
          title: item.title,
          text: item.text
        });
      });
      
      updateOutput();
      
    } catch (err) {
      console.error('fetch operation error: ', err);
    }
  }

  function updateOutput() {
    let result = "";
    for (let i = 0; i < arr.length; i++){
      result += `
      <div style="background: rgba(255,255,255,0.8);
                  
                  margin: 20px auto;
                  padding: 20px;
                  border-radius: 12px;
                  
                  box-shadow: 10px rgba(0,0,0,0.2);">
        <h2>${arr[i].title}</h2>
        <p>${arr[i].text}</p>
        <br>
      </div>
      `;

    }
    output.innerHTML = result;
  }

  const form = document.getElementById("form");
  const output = document.getElementById("output");

  form.addEventListener("submit", async function(event){
    event.preventDefault();

    const title = document.getElementById("title").value;
    const text = document.getElementById("text").value;

    const {data, error} = await db
      .from('posts')
      .insert([{title: title, text: text}])
    if(error) {
      output.innerHTML = "Error: " + error.message;
    } else {
      arr.push({title, text})
      updateOutput();
    }
  });
</script>

</div>